<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Ideator</title>
<style>
  :root {
    --bg: #f8fafc;
    --card: #ffffff;
    --text: #0f172a;
    --muted: #475569;
    --line: #e2e8f0;
    --accent: #166534; /* slightly dark green */
  }
  * { box-sizing: border-box; }
  body { margin: 0; background: linear-gradient(#fff, var(--bg)); color: var(--text); font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
  .wrap { max-width: 980px; margin: 0 auto; padding: 24px; }
  header { margin-bottom: 16px; }
  h1 { margin: 0; font-size: 40px; letter-spacing: -0.02em; color: var(--accent); font-weight: 800; }
  .muted { color: var(--muted); font-size: 14px; }
  .card { background: var(--card); border: 1px solid var(--line); border-radius: 16px; box-shadow: 0 1px 2px rgba(15,23,42,0.04); }
  .pad { padding: 16px; }
  .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
  .btn { appearance: none; border: 1px solid var(--line); background: #fff; color: var(--text); padding: 10px 14px; border-radius: 12px; cursor: pointer; }
  .btn:hover { background: #f1f5f9; }
  .btn.primary { background: #0b0f19; color: #fff; border-color: #0b0f19; }
  .btn.primary:hover { filter: brightness(0.96); }
  .chips { display: flex; flex-wrap: wrap; gap: 8px; }
  .chip { border: 1px solid var(--line); background: #f8fafc; padding: 6px 10px; border-radius: 999px; font-size: 12px; }
  textarea, input[type="text"] { width: 100%; border: 1px solid var(--line); border-radius: 16px; padding: 14px; font: inherit; outline: none; background: #fff; }
  textarea:focus, input[type="text"]:focus { box-shadow: 0 0 0 3px #cbd5e1; }
  textarea { min-height: 220px; resize: vertical; }
  .list { list-style: none; padding: 0; margin: 0; display: grid; gap: 10px; }
  .entry { border: 1px solid var(--line); border-radius: 12px; padding: 10px; }
  .foot { text-align: center; color: var(--muted); font-size: 12px; padding: 24px 0; }
  kbd { border: 1px solid var(--line); border-radius: 6px; padding: 1px 6px; font-size: 12px; background: #fff; }
  .label { text-transform: uppercase; letter-spacing: .12em; font-size: 11px; color: var(--muted); }
  .right { justify-content: flex-end; }
  .toggle { display:inline-flex; align-items:center; gap:8px; font-size: 13px; color: var(--muted); }
  .switch { position: relative; width: 38px; height: 22px; display:inline-block; }
  .switch input { opacity:0; width:0; height:0; }
  .slider { position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background:#cbd5e1; transition:.2s; border-radius:999px; }
  .slider:before { position:absolute; content:""; height:18px; width:18px; left:2px; top:2px; background:white; transition:.2s; border-radius:50%; box-shadow: 0 1px 2px rgba(0,0,0,.18); }
  .switch input:checked + .slider { background:#16a34a; }
  .switch input:checked + .slider:before { transform: translateX(16px); }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>The Ideator</h1>
    </header>

    <!-- Collapsible info box -->
    <div class="card pad" id="infoBox">
      <div class="row" style="justify-content:space-between; align-items:flex-start; gap:12px;">
        <div class="muted" style="max-width: 72ch;">
          this is a interface to enable quick iterations of ideation. You get a prompt how to move with your idea and can start writing, once you run out, you click on Next (or <kbd>Ctrl</kbd> + <kbd>Enter</kbd>) and get a new prompt. Once you finish this chain of ideation, you can clikc Finish and Copy (or <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>Enter</kbd>] to copy your cahin iof ideation. To download the chain, click download. If you want to change the list of prompts, you can scroll to the bottom of this page. Your writing is saved locally in your browser. No  one else has access to it.
        </div>
        <button id="collapseBtn" class="btn" style="padding:6px 10px;">Collapse</button>
      </div>
    </div>

    <!-- Current prompt + controls -->
    <div class="card pad" style="margin-top:16px;">
      <div class="row" style="justify-content:space-between; align-items:flex-end;">
        <div>
          <div class="label">Current prompt</div>
          <div id="currentPrompt" style="font-weight:700; font-size:22px; margin-top:4px;">(loading…)</div>
          <div id="lastPrompt" class="muted" style="font-size:12px; margin-top:2px;"></div>
        </div>
        <div class="row right">
          <button id="nextBtn" class="btn primary">Next</button>
          <button id="finishBtn" class="btn">Finish & Copy</button>
          <button id="downloadBtn" class="btn">Download</button>
          <button id="clearBtn" class="btn">Clear</button>
        </div>
      </div>
    </div>

    <!-- Writing area with Dangerous Mode toggle -->
    <div style="margin-top:12px;">
      <div class="row" style="justify-content:space-between; margin-bottom:6px;">
        <div class="muted"></div>
        <label class="toggle" title="If on, pausing >2s in the first minute clears text (per prompt)">
          Dangerous Mode
          <span class="switch"><input type="checkbox" id="dangerToggle"><span class="slider"></span></span>
        </label>
      </div>
      <textarea id="draft" placeholder="Type here ..."></textarea>
      <div id="dangerStatus" class="muted" style="margin-top:6px; font-size:12px;"></div>
    </div>

    <!-- SESSION ENTRIES always above PROMPT STOCK (single column layout) -->
    <div class="card pad" style="margin-top:16px;">
      <div class="row" style="justify-content:space-between; align-items:center;">
        <h2 style="margin:0; font-size:18px;">Session entries <span class="muted" id="count">(0)</span></h2>
        <input id="titleInput" type="text" placeholder="Add a title/topic (optional)" style="max-width:360px;" />
      </div>
      <ul id="entries" class="list" style="margin-top:10px;"></ul>
    </div>

    <div class="card pad" style="margin-top:16px;">
      <div class="row" style="justify-content:space-between;">
        <h2 style="margin:0; font-size:18px;">Prompt stock</h2>
        <button id="toggleEdit" class="btn">Edit</button>
      </div>
      <div id="stockView" style="margin-top:10px;">
        <div id="chips" class="chips"></div>
        <div class="row" style="margin-top:10px;">
          <input id="addInput" type="text" placeholder="Add a prompt (press Enter)" />
          <button id="addBtn" class="btn">Add</button>
        </div>
      </div>
      <div id="stockEdit" style="display:none; margin-top:10px;">
        <textarea id="stockArea" class="mono" style="height:160px;"></textarea>
        <div class="row" style="justify-content:flex-end; margin-top:8px;">
          <button id="saveStock" class="btn">Save changes</button>
        </div>
      </div>

      <div class="card pad" style="margin-top:12px;">
        <div class="row">
          <button id="copyAll" class="btn">Copy all</button>
          <button id="download2" class="btn">Download .txt</button>
        </div>
        <div class="muted" style="margin-top:6px; font-size:12px;">Data is saved locally (no server).</div>
      </div>
    </div>

    <div class="foot">Built for rapid ideation — no logins, no servers.</div>
  </div>

<script>
  // --- Defaults ---
  const DEFAULT_PROMPTS = [
    "crystallize", "blur", "more abstract", "more concrete",
    "how to implement or execute in ___?",
    "how to communicate to  ____ ?",
    "play defense", "play offense",
    "why is this hard to make progress on?",
    "how to make this more extreme/more unusual/bigger?",
    "how to make this smaller, narrow in?"
  ];

  // --- State (localStorage-backed) ---
  const store = {
    get prompts() { return JSON.parse(localStorage.getItem("ig.prompts") || "null") || DEFAULT_PROMPTS; },
    set prompts(v) { localStorage.setItem("ig.prompts", JSON.stringify(v)); },
    get current() { return JSON.parse(localStorage.getItem("ig.current") || "null"); },
    set current(v) { localStorage.setItem("ig.current", JSON.stringify(v)); },
    get entries() { return JSON.parse(localStorage.getItem("ig.entries") || "[]"); },
    set entries(v) { localStorage.setItem("ig.entries", JSON.stringify(v)); },
    get draft() { return localStorage.getItem("ig.draft") || ""; },
    set draft(v) { localStorage.setItem("ig.draft", v); },
    get last() { return JSON.parse(localStorage.getItem("ig.last") || "null"); },
    set last(v) { localStorage.setItem("ig.last", JSON.stringify(v)); },
    get title() { return localStorage.getItem("ig.title") || ""; },
    set title(v) { localStorage.setItem("ig.title", v); }
  };

  // --- DOM refs ---
  const infoBox = document.getElementById('infoBox');
  const collapseBtn = document.getElementById('collapseBtn');
  const currentPromptEl = document.getElementById("currentPrompt");
  const lastPromptEl = document.getElementById("lastPrompt");
  const nextBtn = document.getElementById("nextBtn");
  const finishBtn = document.getElementById("finishBtn");
  const downloadBtn = document.getElementById("downloadBtn");
  const clearBtn = document.getElementById("clearBtn");
  const draftEl = document.getElementById("draft");
  const entriesUl = document.getElementById("entries");
  const countEl = document.getElementById("count");
  const toggleEditBtn = document.getElementById("toggleEdit");
  const stockView = document.getElementById("stockView");
  const stockEdit = document.getElementById("stockEdit");
  const stockArea = document.getElementById("stockArea");
  const chips = document.getElementById("chips");
  const addInput = document.getElementById("addInput");
  const addBtn = document.getElementById("addBtn");
  const copyAllBtn = document.getElementById("copyAll");
  const download2Btn = document.getElementById("download2");
  const dangerToggle = document.getElementById("dangerToggle");
  const dangerStatus = document.getElementById("dangerStatus");
  const titleInput = document.getElementById("titleInput");

  // --- Dangerous Mode state ---
  let danger = {
    active: false,
    startTs: null,
    endTs: null,
    lastTypeTs: null,
    interval: null
  };

  function startDangerWindow() {
    if (!dangerToggle.checked || danger.active) return;
    danger.active = true;
    danger.startTs = Date.now();
    danger.endTs = danger.startTs + 60_000; // 1 minute
    danger.lastTypeTs = Date.now();
    dangerStatus.textContent = "Dangerous Mode active: pausing > 2s will clear text for 1 minute.";
    danger.interval = setInterval(() => {
      const now = Date.now();
      if (!dangerToggle.checked) { stopDanger("Dangerous Mode off."); return; }
      if (now > danger.endTs) { stopDanger("Dangerous Mode is over for this prompt."); return; }
      if (now - danger.lastTypeTs > 2000) { // 2 seconds pause
        draftEl.value = ""; store.draft = "";
      }
    }, 250);
  }

  function stopDanger(msg="") {
    if (danger.interval) clearInterval(danger.interval);
    danger = { active:false, startTs:null, endTs:null, lastTypeTs:null, interval:null };
    dangerStatus.textContent = msg;
  }

  function resetDangerForNewPrompt() {
    stopDanger(""); // clear any prior state
    if (dangerToggle.checked) {
      dangerStatus.textContent = "Dangerous Mode armed for this prompt (starts on first keystroke).";
    } else {
      dangerStatus.textContent = "";
    }
  }

  function randPrompt(stock, last) {
    if (!stock.length) return "(add prompts)";
    if (stock.length === 1) return stock[0];
    let p; do { p = stock[Math.floor(Math.random() * stock.length)]; } while (p === last);
    return p;
  }

  function renderPrompts() {
    chips.innerHTML = "";
    store.prompts.forEach(p => {
      const span = document.createElement("span");
      span.className = "chip"; span.textContent = p; chips.appendChild(span);
    });
    stockArea.value = store.prompts.join("
");
  }

  function renderEntries() {
    entriesUl.innerHTML = "";
    const entries = store.entries;
    countEl.textContent = `(${entries.length})`;
    if (entries.length === 0) {
      const li = document.createElement("li");
      li.className = "entry muted"; li.textContent = "No entries yet. Start typing and press Next."; entriesUl.appendChild(li); return;
    }
    entries.forEach((e, i) => {
      const li = document.createElement("li");
      li.className = "entry";
      const time = new Date(e.ts).toLocaleTimeString();
      li.innerHTML = `<div class="muted" style="font-size:12px;">#${i+1} · ${time}</div>
                      <div style="font-weight:600;">${e.prompt}</div>
                      <div style="white-space:pre-wrap; font-size:14px; margin-top:4px;">${e.text ? escapeHtml(e.text) : '<span class="muted">(no text)</span>'}</div>`;
      entriesUl.appendChild(li);
    });
  }

  function escapeHtml(str){ return str.replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[s])); }

  function setPrompt(p) {
    store.last = store.current || null;
    store.current = p;
    currentPromptEl.textContent = p;
    lastPromptEl.textContent = store.last ? `(last: ${store.last})` : "";
    resetDangerForNewPrompt();
  }

  function exportText() {
    const titleLine = store.title ? `Title: ${store.title}
` : "";
    const header = `Ideator Session Export
${titleLine}Date: ${new Date().toLocaleString()}
Prompts used: ${[...new Set(store.entries.map(e => e.prompt))].join(", ")}
`;
    const body = store.entries.map((e,i) => `
### ${i+1}. ${e.prompt} (at ${new Date(e.ts).toLocaleTimeString()})
${(e.text||"").trim()}
`).join("");
    return header + "
" + body;
  }

  function download(filename, text) {
    const blob = new Blob([text], {type:"text/plain;charset=utf-8"});
    const url = URL.createObjectURL(blob); const a = document.createElement("a");
    a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }

  // --- Actions ---
  function next() {
    const t = (draftEl.value || "").trim();
    if (t.length > 0 || store.entries.length === 0) {
      const entry = { prompt: store.current || randPrompt(store.prompts), text: t, ts: Date.now() };
      const arr = store.entries; arr.push(entry); store.entries = arr;
      draftEl.value = ""; store.draft = ""; renderEntries();
    }
    setPrompt(randPrompt(store.prompts, store.current));
    draftEl.focus();
  }

  async function finishCopy() {
    const t = (draftEl.value || '').trim();
    if (t.length > 0) {
      const arr = store.entries; arr.push({ prompt: store.current || "(none)", text: t, ts: Date.now() });
      store.entries = arr; draftEl.value = ''; store.draft = '';
      renderEntries();
    }
    const txt = exportText();
    try { await navigator.clipboard.writeText(txt); alert("Copied session to clipboard!"); } catch {}
  }

  function clearSession() {
    if (!confirm("Clear all entries and draft?")) return;
    store.entries = []; draftEl.value = ""; store.draft = ""; renderEntries();
  }

  // --- Events ---
  nextBtn.onclick = next;
  finishBtn.onclick = finishCopy;
  downloadBtn.onclick = () => download("ideator_session.txt", exportText());
  clearBtn.onclick = clearSession;
  draftEl.oninput = () => {
    if (danger.active) danger.lastTypeTs = Date.now();
    else if (dangerToggle.checked) startDangerWindow();
    store.draft = draftEl.value;
  };
  addBtn.onclick = () => {
    const v = (addInput.value || '').trim(); if (!v) return;
    const s = store.prompts.slice(); if (!s.includes(v)) s.push(v); store.prompts = s; addInput.value = ''; renderPrompts();
  };
  addInput.onkeydown = (e) => { if (e.key === 'Enter') addBtn.click(); };
  toggleEditBtn.onclick = () => {
    const edit = stockEdit.style.display === 'none';
    stockEdit.style.display = edit ? 'block' : 'none';
    stockView.style.display = edit ? 'none' : 'block';
    if (edit) stockArea.value = store.prompts.join('
');
  };
  document.getElementById('saveStock').onclick = () => {
    const lines = stockArea.value.split(/
+/).map(s => s.trim()).filter(Boolean);
    store.prompts = lines; renderPrompts(); toggleEditBtn.click();
  };
  copyAllBtn.onclick = finishCopy;
  download2Btn.onclick = () => download('ideator_session.txt', exportText());

  titleInput.oninput = () => { store.title = titleInput.value; };

  // Keyboard shortcuts
  window.addEventListener('keydown', (e) => {
    const cmd = e.metaKey || e.ctrlKey;
    if (cmd && e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); next(); }
    if (cmd && e.key === 'Enter' && e.shiftKey) { e.preventDefault(); finishCopy(); }
    if (cmd && e.key.toLowerCase() === 'k') { e.preventDefault(); draftEl.focus(); }
  });

  // Info collapse
  collapseBtn.addEventListener('click', () => {
    const hidden = infoBox.getAttribute('data-collapsed') === 'true';
    if (hidden) { infoBox.style.display = ''; infoBox.setAttribute('data-collapsed','false'); collapseBtn.textContent = 'Collapse'; }
    else { infoBox.style.display = 'none'; infoBox.setAttribute('data-collapsed','true'); collapseBtn.textContent = 'Expand'; }
  });

  // --- Init ---
  (function init(){
    renderPrompts();
    setPrompt(store.current || randPrompt(store.prompts));
    draftEl.value = store.draft;
    titleInput.value = store.title;
    renderEntries();
    resetDangerForNewPrompt();
  })();
</script>
</body>
</html>
