<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Ideator</title>
<style>
  :root {
    --bg: #f8fafc; --card: #ffffff; --text: #0f172a; --muted: #475569;
    --line: #e2e8f0; --accent: #166534;
  }
  * { box-sizing: border-box; }
  body { margin: 0; background: linear-gradient(#fff, var(--bg)); color: var(--text);
         font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
  .wrap { max-width: 980px; margin: 0 auto; padding: 24px; }
  header { margin-bottom: 16px; }
  h1 { margin: 0; font-size: 40px; letter-spacing: -0.02em; color: var(--accent); font-weight: 800; }
  .muted { color: var(--muted); font-size: 14px; }
  .card { background: var(--card); border: 1px solid var(--line);
          border-radius: 16px; box-shadow: 0 1px 2px rgba(15,23,42,0.04); }
  .pad { padding: 16px; }
  .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
  .row.gap-12 { gap: 12px; }
  .grow { flex: 1 1 auto; min-width: 220px; }
  .right { justify-content: flex-end; }
  .btn { appearance: none; border: 1px solid var(--line); background: #fff; color: var(--text);
         padding: 10px 14px; border-radius: 12px; cursor: pointer; }
  .btn:hover { background: #f1f5f9; }
  .btn.primary { background: #0b0f19; color: #fff; border-color: #0b0f19; }
  .btn.primary:hover { filter: brightness(0.96); }
  .chips { display: flex; flex-wrap: wrap; gap: 8px; }
  .chip { border: 1px solid var(--line); background: #f8fafc; padding: 6px 10px; border-radius: 999px; font-size: 12px; }
  textarea, input[type="text"] { width: 100%; border: 1px solid var(--line); border-radius: 16px; padding: 14px; font: inherit; outline: none; background: #fff; }
  textarea:focus, input[type="text"]:focus { box-shadow: 0 0 0 3px #cbd5e1; }
  textarea { min-height: 220px; resize: vertical; }
  .list { list-style: none; padding: 0; margin: 0; display: grid; gap: 10px; }
  .entry { border: 1px solid var(--line); border-radius: 12px; padding: 10px; }
  .foot { text-align: center; color: var(--muted); font-size: 12px; padding: 24px 0; }
  .label { text-transform: uppercase; letter-spacing: .12em; font-size: 11px; color: var(--muted); }
  .danger-active { outline: 2px dashed #ef4444; outline-offset: 2px; }
</style>
</head>
<body>
  <div class="wrap">
    <header><h1>The Ideator</h1></header>

    <details id="infoBox" class="card pad">
      <summary class="btn" style="display:inline-block; margin-bottom:8px;">Info</summary>
      <div class="muted" style="max-width:72ch;">
        This interface helps fast iteration. Type freely. Click <b>Next</b> (or <kbd>Ctrl</kbd>/<kbd>⌘</kbd>+<kbd>Enter</kbd>) for a new prompt.
        Click <b>Finish & Copy</b> (or <kbd>Ctrl</kbd>/<kbd>⌘</kbd>+<kbd>Shift</kbd>+<kbd>Enter</kbd>) to copy your chain.
        Data is saved locally in your browser.
      </div>
    </details>

    <div class="card pad" style="margin-top:16px;">
      <div class="row" style="justify-content:space-between; align-items:flex-end;">
        <div class="grow">
          <div class="label">Current prompt</div>
          <div id="currentPrompt" style="font-weight:700; font-size:22px; margin-top:4px;">(loading…)</div>
          <div id="lastPrompt" class="muted" style="font-size:12px; margin-top:2px;"></div>
        </div>
        <div class="row right gap-12">
          <button id="nextBtn" class="btn primary">Next</button>
          <button id="finishBtn" class="btn">Finish & Copy</button>
          <button id="downloadBtn" class="btn">Download</button>
          <button id="clearBtn" class="btn">Clear</button>
        </div>
      </div>
    </div>

    <div style="margin-top:12px;">
      <div class="row" style="justify-content:space-between; margin-bottom:6px;">
        <label class="toggle" title="If on, pausing > 2s in the first minute clears text (per prompt)">
          Dangerous Mode
          <span class="switch" style="position:relative; width:38px; height:22px; display:inline-block;">
            <input type="checkbox" id="dangerToggle" style="opacity:0; width:0; height:0;">
            <span class="slider" style="position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background:#cbd5e1; transition:.2s; border-radius:999px;">
              <span style="position:absolute; content:''; height:18px; width:18px; left:2px; top:2px; background:white; transition:.2s; border-radius:50%; box-shadow:0 1px 2px rgba(0,0,0,.18);"></span>
            </span>
          </span>
        </label>
        <a href="prompts.html" class="btn" title="Manage prompt stock">Manage prompts</a>
      </div>
      <textarea id="draft" placeholder="Type here ..."></textarea>
      <div id="dangerStatus" class="muted" style="margin-top:6px; font-size:12px;"></div>
    </div>

    <div class="card pad" style="margin-top:16px;">
      <!-- Topic/Title to the right of Session entries -->
      <div class="row" style="justify-content:space-between; align-items:center; gap:12px;">
        <h2 class="grow" style="margin:0; font-size:18px;">Session entries <span class="muted" id="count">(0)</span></h2>
        <label for="titleInput" class="muted" style="font-size:14px;">Topic/Title:</label>
        <input id="titleInput" type="text" placeholder="Add a title/topic (optional)" style="max-width:360px;" />
      </div>
      <ul id="entries" class="list" style="margin-top:10px;"></ul>
    </div>

    <div class="card pad" style="margin-top:16px;">
      <div class="row" style="justify-content:space-between; align-items:center;">
        <h2 style="margin:0; font-size:18px;">Prompt stock (read-only)</h2>
        <span class="muted" style="font-size:12px;">Edit in “Manage prompts”</span>
      </div>
      <div id="chips" class="chips" style="margin-top:10px;"></div>
    </div>

    <div class="foot">Built for rapid ideation — no logins, no servers.</div>
  </div>

<script>
  // ===== Defaults =====
  const DEFAULT_PROMPTS = [
    "crystallize","blur","more abstract","more concrete",
    "how to implement or execute?","how to communicate?",
    "play defense","play offense","why is this hard to make progress on?",
    "How to make bigger/more imaginary/radical?",
    "How to make more narrow/concrete/implementable next week?"
  ];

  // ===== Local store =====
  const store = {
    get prompts(){ try{return JSON.parse(localStorage.getItem("ig.prompts")||"null")||DEFAULT_PROMPTS;}catch{return DEFAULT_PROMPTS;} },
    set prompts(v){ localStorage.setItem("ig.prompts", JSON.stringify(v)); },
    get current(){ try{return JSON.parse(localStorage.getItem("ig.current")||"null");}catch{return null;} },
    set current(v){ localStorage.setItem("ig.current", JSON.stringify(v)); },
    get entries(){ try{return JSON.parse(localStorage.getItem("ig.entries")||"[]");}catch{return [];} },
    set entries(v){ localStorage.setItem("ig.entries", JSON.stringify(v)); },
    get title(){ return localStorage.getItem("ig.title")||""; },
    set title(v){ localStorage.setItem("ig.title", v||""); }
  };

  // ===== DOM =====
  const chips = document.getElementById("chips");
  const currentPromptEl = document.getElementById("currentPrompt");
  const lastPromptEl = document.getElementById("lastPrompt");
  const draftEl = document.getElementById("draft");
  const entriesUl = document.getElementById("entries");
  const countEl = document.getElementById("count");
  const titleInput = document.getElementById("titleInput");
  const dangerToggle = document.getElementById("dangerToggle");
  const dangerStatus = document.getElementById("dangerStatus");

  // ===== Utils =====
  function slug(s){ return (s||"").toLowerCase().trim().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'').slice(0,60)||'session'; }
  function randPrompt(stock,last){ if(!stock.length) return "(add prompts)"; if(stock.length===1) return stock[0];
    let p; do{ p=stock[Math.floor(Math.random()*stock.length)]; } while(p===last); return p; }
  function escapeHtml(str){ return String(str).replace(/[&<>\"']/g, s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s])); }

  // ===== Dangerous Mode =====
  let danger={active:false,startTs:null,endTs:null,lastTypeTs:null,interval:null};
  function setDangerUI(on){ draftEl.classList.toggle('danger-active', !!on); }
  function startDangerWindow(){
    if(!dangerToggle.checked || danger.active) return;
    danger.active=true; danger.startTs=Date.now(); danger.endTs=danger.startTs+60_000; danger.lastTypeTs=Date.now();
    setDangerUI(true);
    dangerStatus.textContent="Dangerous Mode active: 60s window. Pausing > 2s clears text.";
    danger.interval=setInterval(()=>{
      const now=Date.now();
      if(!dangerToggle.checked){ stopDanger("Dangerous Mode off."); return; }
      const remaining=Math.max(0, Math.ceil((danger.endTs-now)/1000));
      if(now>danger.endTs){ stopDanger("Dangerous Mode is over for this prompt."); return; }
      dangerStatus.textContent=`Dangerous Mode active — ${remaining}s left. Pausing > 2s clears text.`;
      if(now-danger.lastTypeTs>2000){ draftEl.value=""; danger.lastTypeTs=now; }
    },200);
  }
  function stopDanger(msg=""){
    if(danger.interval) clearInterval(danger.interval);
    danger={active:false,startTs:null,endTs:null,lastTypeTs:null,interval:null};
    setDangerUI(false); dangerStatus.textContent=msg;
  }
  function resetDangerForNewPrompt(){ stopDanger(""); if(dangerToggle.checked) dangerStatus.textContent="Dangerous Mode armed for this prompt (starts on first keystroke)."; }

  // ===== Renderers =====
  function renderPrompts(){
    chips.innerHTML="";
    (store.prompts||[]).forEach(p=>{
      const span=document.createElement("span"); span.className="chip"; span.textContent=p; chips.appendChild(span);
    });
  }
  function renderEntries(){
    entriesUl.innerHTML="";
    const entries=store.entries||[]; countEl.textContent=`(${entries.length})`;
    entries.forEach(e=>{
      const li=document.createElement("li"); li.className="entry";
      li.innerHTML=`<b>${escapeHtml(e.prompt||"(none)")}</b><br>${escapeHtml(e.text||"")}`;
      entriesUl.appendChild(li);
    });
  }
  function setPrompt(p){
    if(store.current) lastPromptEl.textContent=`Last: ${store.current}`;
    store.current=p; currentPromptEl.textContent=p; resetDangerForNewPrompt();
  }

  // ===== Actions =====
  function next(){
    const t=draftEl.value.trim();
    if(t){ store.entries=[...(store.entries||[]), {prompt:store.current||"(none)", text:t}]; draftEl.value=""; renderEntries(); }
    setPrompt(randPrompt(store.prompts, store.current)); draftEl.focus();
  }
  async function finishCopy(){
    next();
    const header = store.title ? `Title: ${store.title}\n\n` : "";
    const txt = header + (store.entries||[]).map((e,i)=>`${i+1}. ${e.prompt}\n${e.text}`).join("\n\n");
    try{ await navigator.clipboard.writeText(txt); alert("Copied to clipboard!"); }catch{}
  }
  function downloadFile(){
    const header = store.title ? `Title: ${store.title}\n\n` : "";
    const txt = header + (store.entries||[]).map((e,i)=>`${i+1}. ${e.prompt}\n${e.text}`).join("\n\n");
    const blob=new Blob([txt],{type:"text/plain"}); const url=URL.createObjectURL(blob);
    const a=document.createElement("a"); a.href=url; a.download=`ideator_${slug(store.title)}.txt`; a.click(); URL.revokeObjectURL(url);
  }
  function clearSession(){ if(confirm("Clear all entries?")){ store.entries=[]; renderEntries(); } }

  // ===== Init =====
  (function init(){
    renderPrompts();
    setPrompt(store.current || randPrompt(store.prompts, null));
    renderEntries();
    titleInput.value = store.title;
  })();

  // ===== Events =====
  document.getElementById("nextBtn").onclick = next;
  document.getElementById("finishBtn").onclick = finishCopy;
  document.getElementById("downloadBtn").onclick = downloadFile;
  document.getElementById("clearBtn").onclick = clearSession;
  titleInput.oninput = ()=>{ store.title = titleInput.value; };

  // Dangerous-mode arming + typing heartbeat
  draftEl.addEventListener('keydown', ()=>{ if(dangerToggle.checked && !danger.active) startDangerWindow(); danger.lastTypeTs=Date.now(); });
  dangerToggle.addEventListener('change', ()=>{ if(!dangerToggle.checked) stopDanger("Dangerous Mode off."); else dangerStatus.textContent="Dangerous Mode armed for this prompt (starts on first keystroke)."; });

  // Keyboard shortcuts
  window.addEventListener("keydown", e=>{
    if((e.ctrlKey||e.metaKey) && e.key==="Enter" && !e.shiftKey){ e.preventDefault(); next(); }
    if((e.ctrlKey||e.metaKey) && e.key==="Enter" &&  e.shiftKey){ e.preventDefault(); finishCopy(); }
  });

  // Small slider knob move (pure CSS alternative would require sibling selector).
  // This keeps visual in sync when toggled:
  dangerToggle.addEventListener('change', (e)=>{
    const knob = e.target.nextElementSibling.querySelector('span');
    knob.style.transform = e.target.checked ? 'translateX(16px)' : 'translateX(0)';
    e.target.nextElementSibling.style.background = e.target.checked ? '#16a34a' : '#cbd5e1';
  });
</script>
</body>
</html>
